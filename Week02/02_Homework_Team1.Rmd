---
title: "Practice2 (Team1)"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, out.width="100%")
library(dplyr)
library(stringr)
library(tidyr)
library(ggplot2)
library(lubridate)
library(reshape2)
library(unikn)
options("scipen" = 1000)
theme_set(theme_grey(base_family='NanumGothic'))
```

### Loading data
```{r}
trade_df <- read.csv('https://raw.githubusercontent.com/Paul-scpark/Data_Mining_Practicum/main/data/Monthly_export_import.csv', header = T, fileEncoding = "euc-kr")
ISO_code <- read.csv('https://raw.githubusercontent.com/Paul-scpark/Data_Mining_Practicum/main/data/ISO_code.csv', header = T, fileEncoding = "euc-kr")
continent <- read.csv('https://raw.githubusercontent.com/Paul-scpark/Data_Mining_Practicum/main/data/continent_table.csv')
```

### 1. Preprocessing
```{r}
str(trade_df)
length(unique(trade_df$국가명))
colSums(is.na(trade_df))
```

'수출입통계' 데이터를 부른 후, str 함수를 통해서 전반적인 변수들의 type을 확인해본다.

또한 고유한 국가명들이 몇 개가 있는지, 각 변수 별로 NA가 있는지 확인한다.

```{r}
trade_df$기간 <- as.character(trade_df$기간)
head(trade_df[str_length(trade_df$기간) != 7, ])
```

우선 Date 형태로 바꿔주기 위하여 주어진 '기간' 변수를 확인해본다.

기존 데이터의 형태는 '2000.01' 형태이므로 str_length 함수로 문자열의 개수를 확인해보면, 7이 나와야 한다.

하지만, 위 결과처럼 문자열 개수가 7이 아닌 데이터들이 있음을 확인했다.

자세히 보니, 위 데이터는 10월인데, 맨 뒤의 0이 빠져서 1월처럼 표현이 되어 있는 것이다.

```{r}
trade_df$기간 <- str_pad(trade_df$기간, width = 7, side = 'right', pad = '0')
trade_df$기간 <- as.Date(paste0(as.character(trade_df$기간), '.01'), format = '%Y.%m.%d')
head(unique(trade_df$기간), 12)
```

따라서 str_pad 함수를 통해서 문자열의 개수를 7로 맞추고, 7이 아니면 맨 뒤에 0을 붙여준다.

그리고 Date 형태로 바꾸고 위하여 '2000.01' 형태의 데이터에 날짜를 의미하는 '.01'을 붙여준다.

이렇게 되면, 각 월 별로 '2000.01.01', '2000.02.01', '2000.03.01' 형태의 데이터를 만든다.

이 과정을 통해 '기간' 변수에 대한 unique 값을 확인해보면, 1월부터 12월까지 잘 나오는 것을 볼 수 있다.

```{r}
trade_df[, 3:7] <- lapply(trade_df[, 3:7], gsub, pattern = ',', replacement = '')
trade_df[, 3:7] <- lapply(trade_df[, 3:7], as.double)
str(trade_df)
head(trade_df)
```

또한 '수출건수' 부터 '무역수지' 데이터는 수치형 변수인데, 콤마 등으로 인해 형 변환이 안되기 때문에 gsub 함수로 특수 문자를 제거한다.

그리고 lapply 함수를 통해서 multiple columns에 대하여 Double type으로 형 변환을 실시한다.

이를 통해 최종적으로 변수의 type을 str 함수를 통해서 확인할 수 있다.

### 2. Total export and import volumes of Korea
```{r}
Total_export_import <- as.data.frame(left_join(aggregate(수출건수~기간, trade_df, sum), 
                                               aggregate(수입건수~기간, trade_df, sum), by = '기간'))
colnames(Total_export_import) <- c('Date', 'Total_export', 'Total_import')
head(Total_export_import, 12) 
```

여기서 Total_export_import 테이블을 여러가지 방식으로 정리할 수 있다. 

먼저, 월별 수출입 건수의 추이를 살펴보기 위해서,같은 연도의 데이터끼리 grouping을 한 후 데이터의 월 별 특징을 확인하려고 한다.

```{r}
seperate_Total_port<- Total_export_import %>% mutate(year = as.numeric(format(Total_export_import$Date, format= "%Y")),
                         month = as.numeric(format(Total_export_import$Date, format = "%m")))

```
year, month의 형태로 저장된 값을 format함수를 사용하여 break하여 년, 월 컬럼을 따로 생성하여 추가. (numeric 타입으로 저장)
```{r}
seperate_Total_port %>% 
  ggplot(aes(x = month, y = Total_export, color = year, group = year)) +
  geom_line()+
  geom_point(size = 2) +
  scale_x_continuous(breaks = seq(1, 12, 1))+ #x축을 직접 설정
  ggtitle('2000~2021 월별 수출건수 변화')
```
x: month, y: Total_export, 각 line_graph을 year으로 구분짓기 위해 color, group의 기준은 year로 설정.

위 그래프를 통해서 알 수 있는 것은 다음과 같다.
1. 2월달은 1월달에 비해 수출건수가 감소한다.
2. 3월달에 수출건수가 반등하며, 이 반등한 건수는 1월달의 건수보다 높다. 
3. 최근 년도에 10월보다 11월달의 수출건수가 급등하는 양상을 볼 수 있다.   

```{r}
seperate_Total_port %>% 
  ggplot(aes(x = month, y = Total_import, color = year, group = year)) +
  geom_line()+
  geom_point(size = 2) +
  scale_x_continuous(breaks = seq(1, 12, 1))+ #x축을 직접 설정
  ggtitle('2000~2021 월별 수입건수 변화')
```
x: month, y: Total_import, 각 line_graph을 year으로 구분짓기 위해 color, group의 기준은 year로 설정.

1, 2월달의 수입 건수는 1월달에 비해 확연히 줄어든다. 

2. 2월달의 하락했던 수입건수는 3월달에 다시 회복된다. 


그리고, 다음 시각화는 2000~2021년도까지 시계열 데이터를 일직선상에 두고 전체적인 흐름을 살필 수 있는 장점이 있다.

수출입통계 데이터는 월별로 각 국가에 대해 대한민국의 수출, 수입 데이터를 정리한 것이다.

월별로 수출과 수입 데이터의 합을 구하면, 대한민국의 월별 전체 수출 및 수입량을 계산할 수 있다.

이를 위해서 aggregate 함수로 수출건수와 수입건수의 합을 구하고, '기간'을 key 값으로 left_join 한다.

```{r}
df_long <- melt(Total_export_import, id = 'Date')
ggplot(df_long, aes(x = Date, y = value, col = variable)) + geom_line()
```

그 후에는 X축을 Date로 하여 전체 수출(Total_export), 수입(Total_import)을 각각 그래프로 표시한다.

이를 통해 알 수 있는 것은 다음과 같다.

1. 2000년부터 2021년까지 대한민국의 전체 수출량 및 수입량은 계속해서 증가하는 추세를 보인다.

2. 대한민국은 전체 수출량보다, 전체 수입량이 더 많은 것을 확인할 수 있다.

3. 2010년 이후 대한민국의 전체 수입량은 그 전에 비해서 급격히 증가하고 있다.

```{r}
Total_export_import %>% 
  mutate(month = month(Date), 
         season = ifelse(month %in% c(3, 4, 5), '봄', 
                    ifelse(month %in% c(6, 7, 8), '여름', 
                      ifelse(month %in% c(9, 10, 11), '가을', '겨울')))) %>% 
  select(Total_export, Total_import, season) %>% 
  melt(id = 'season') %>% 
  ggplot(aes(x = factor(season), y = value, fill = variable)) +
  geom_boxplot() +
  ggtitle('계절별 수출 및 수입 건수의 합계') +
  theme(plot.title = element_text(hjust=0.5))
```

다음으로는 계절 별로 그룹을 나눠서 수출과 수입 건수의 합계가 차이가 있는지 확인하는 방법이다.

3~5월을 봄, 6~8월을 여름, 9~11월을 가을, 12~2월을 겨울로 하여 계절 별 수치에 대한 데이터를 boxplot으로 표현해본다.

그 결과는 그래프에서 알 수 있듯, 전반적으로 계절 별 값의 큰 차이는 없는 것으로 확인할 수 있다.

```{r}
Total_export_import %>% 
  mutate(year = year(Date)) %>% 
  group_by(year) %>% 
  summarise(yearly_export_sum = sum(Total_export), 
            yearly_import_sum = sum(Total_import), 
            yearly_export_mean = mean(Total_export), 
            yearly_import_mean = mean(Total_import)) %>% 
  melt(id = 'year') %>% 
  ggplot(aes(x = year, y = value, color = variable)) +
  geom_line() +
  ggtitle('연도별 수출, 수입 건수의 합계 및 평균') +
  theme(plot.title = element_text(hjust=0.5))
```

마지막으로는 연도 별로 수출과 수입 건수에 대한 추이를 확인해보도록 한다.

연도 별로 건수에 대한 합계와 평균을 구하여 그래프를 그려보았다.

전반적으로 수출과 수입 건수는 증가하는 모습을 보였고, 그 중 수입 건수는 상대적으로 수출 건수보다 더 급하게 상승하는 것을 볼 수 있다.

### 3. Impact of COVID-19 by Korea's export and import

자료에 따르면, 전 세계에서 첫 코로나 환자 발생 시기는 2019년 12월이다. 

그리고 이후, 2020년 1월 8일에는 대한민국에서 국내 첫 코로나 환자가 발생했다.

시간이 흘러서 계속해서 그 감염세가 확산됨에 따라 WHO는 2020년 3월에 팬데믹을 선포했다.

#### 3.1 평균 수입 및 수출 건수
```{r}
trade_df %>% 
  filter(기간 >= '2010-01-01') %>% 
  group_by(기간) %>% 
  summarise(mean_import = mean(수입건수), 
            mean_export = mean(수출건수)) %>% 
  gather(colname, value, 2:3) %>% 
  ggplot(aes(x = 기간, y = value, color = colname)) +
  geom_line(aes(color = colname)) + 
  geom_point(aes(color = colname), size = 0.2) +
  geom_vline(xintercept = as.numeric(ymd("2020-01-01")), 
             color = 'black', size = 1, alpha = 0.4) +
  ggtitle('대한민국의 평균 수입, 수출 건수') + 
  theme(plot.title = element_text(hjust=0.5))
```

코로나 바이러스가 대한민국의 수출입에 영향을 주는지 확인해보도록 한다.

가장 먼저는 수입과 수출 건수에 얼마나 영향을 줬는지 확인하기 위하여 그래프를 그려보았다.

또한 코로나의 영향도를 확인하기 위하여 국내에서 첫 환자가 발생했던 2020년 1월을 표시했다.

수입과 수출 건수는 2010년부터 2021년까지 꾸준히 증가하는 추세를 보이고 있다.

또한 코로나가 발생했던 2020년 1월 시점 역시, 감소하는 형태는 보이지 않는다.

#### 3.2 평균 수입 및 수출 금액 

```{r}
trade_df %>% 
  filter(기간 >= '2010-01-01') %>% 
  group_by(기간) %>% 
  summarise(평균_수출금액 = mean(수출금액), 
            평균_수입금액 = mean(수입금액)) %>% 
  gather(colname, value, 2:3) %>% 
  ggplot(aes(x = 기간, y = value, color = colname)) +
  geom_line(aes(color = colname)) + 
  geom_point(aes(color = colname), size = 0.2) +
  geom_vline(xintercept = as.numeric(ymd("2020-01-01")), 
             color = 'black', size = 1) +
  facet_wrap(colname ~ ., ncol = 1) +
  ggtitle('대한민국의 평균 수입, 수출 금액') + 
  theme(plot.title = element_text(hjust=0.5))
```

평균 수입, 수출 금액에 대한 그래프도 확인해보았다.

수입과 수출 금액 데이터는 건수 데이터에 비해 상당히 변동성이 크게 움직이고 있다.

다만, 문제에서 확인하고자 하는 코로나가 발생했던 2020년 1월 경에는 수출입 금액이 모두 감소했다.

#### 3.3 대한민국의 주요 무역국가들에 대하여 수출금액, 수입금액, 무역수지의 추이
```{r}
trade_df %>% 
  filter(국가명 %in% c('미국', '중국', '일본', '베트남', '싱가포르', '대만'), 
         기간 >= '2010-01-01') %>% 
  select(기간, 국가명, 수출금액, 수입금액, 무역수지) %>% 
  gather(colname, value, 3:5) %>% 
  ggplot(aes(x = 기간, y = value, color = 국가명)) +
  geom_line(aes(color = 국가명)) + 
  geom_point(aes(color = 국가명), size = 0.1) +
  facet_wrap(colname ~ ., ncol = 1) +
  geom_vline(xintercept = as.numeric(ymd("2020-01-01")), 
             color = 'black', size = 1, alpha = 0.4)
```

그 다음으로는 대한민국의 주요 무역국가들에 대하여 수출과 수입에 대한 전반적인 추이를 비교해보도록 한다.

주요 무역 국가는 미국, 중국, 일본, 베트남, 싱가포르, 대만으로 했다.

무역수지와 수입 및 수출 금액에 대한 추이를 그래프를 통해서 확인해보도록 한다.

눈에 띄게 확인할 수 있는 것은 중국과 미국은 우리나라와 수입과 수출 금액이 약 20년동안 가장 높은 국가였다.

한편, 수출과 수입의 차이를 의미하는 무역수지 데이터에서 일본은 20년동안 음수였다는 것도 확인해볼 수 있다.

#### 3.4 대한민국의 주요 무역국가들에 대하여 수출 및 수입 건수의 추이
```{r}
trade_df %>% 
  filter(국가명 %in% c('미국', '중국', '일본', '베트남', '싱가포르', '대만'),
         기간 >= '2010-01-01') %>% 
  select(기간, 국가명, 수출건수) %>% 
  gather(colname, value, 3) %>% 
  ggplot(aes(x = 기간, y = value, color = 국가명)) +
  geom_line(aes(color = 국가명)) + 
  geom_point(aes(color = 국가명), size = 0.1) +
  facet_wrap(colname ~ ., ncol = 1) +
  geom_vline(xintercept = as.numeric(ymd("2020-01-01")), 
             color = 'black', size = 1, alpha = 0.4)
```

```{r}
trade_df %>% 
  filter(국가명 %in% c('미국', '중국', '일본', '베트남', '싱가포르', '대만'), 
         기간 >= '2010-01-01') %>% 
  select(기간, 국가명, 수입건수) %>% 
  gather(colname, value, 3) %>% 
  ggplot(aes(x = 기간, y = value, color = 국가명)) +
  geom_line(aes(color = 국가명)) + 
  geom_point(aes(color = 국가명), size = 0.1) +
  facet_wrap(colname ~ ., ncol = 1) +
  geom_vline(xintercept = as.numeric(ymd("2020-01-01")), 
             color = 'black', size = 1, alpha = 0.4)
```

마지막으로는 주요 무역국가들에 대한 수출과 수입 건수의 추이를 확인해보도록 한다.

수입에 대해서는 미국이 급격히 수입 건수 추이가 증가했다는 것을 볼 수 있으며, 코로나 직후에는 중국의 수입이 급격히 줄어들었다.

또한 코로나가 시작된 2020년 초반부터 우리나라가 일본에 대하여 수출한 건수가 점차적으로 증가하는 것도 확인할 수 있다.

#### 3.5.대한민국의 주요 무역국가인 미국과 중국에 대한 전년도 대비 수출입 건수 증가 비율.

미국, 중국에 대해서 전년도 대비 수출입 건수의 증가 비율을 구하고자 한다.

그 이유는 매년 마다 수출입의 건수는 증가하는 것을 볼 수 있다. 

그러나 그 증가 비율이 전년도에 비해 어떤 비율로 증감했는지 비교함으로써, 

수출입 건수가 증가하는 패턴 속에서도 해당 연도의 건수가 코로나로 인해 다른 해보다 증가비율의 규모를 확인할 수 있기 때문이다. 

```{r}
seperate_trade_df <- trade_df %>% mutate(year = as.numeric(format(trade_df$기간, format= "%Y")),
                         month = as.numeric(format(trade_df$기간, format = "%m")))

```
year, month의 형태로 저장된 값을 format함수를 사용하여 break하여 년, 월 컬럼을 따로 생성하여 추가. (numeric 타입으로 저장)

미국과의 수출입 영향에 대해 알아보고자 한다.

먼저 seperate_trade_df에서 미국의 2017~2021년 데이터를 필터링하여 new1에 저장.

```{r}
new1 <-seperate_trade_df %>% filter(국가명=="미국") %>% 
  filter(year %in% c(2017, 2018, 2019, 2020, 2021))
```

미국의 데이터 중 2017년 데이터 data_2017에 저장. 
```{r}
data_2017<-new1 %>% 
  filter(year== 2017)
data_2018<-new1 %>% 
  filter(year== 2018)
data_2019<-new1 %>% 
  filter(year== 2019)
data_2020<-new1 %>% 
  filter(year== 2020)
data_2021<-new1 %>% 
  filter(year== 2021)

```
수출건수의 변화비율을 시각화하고자 한다.
해당 연도의 수출건수 벡터(1월~12월)에서 전년도 수출건수 벡터(1월~12월)을 뺸 값을 전년도 해당 월의 수출건수으로 나누어 100곱해서 변화비율을 계산한다. 월 별 변화비율로 비루어진 벡터를 각 2018, 2019, 2020, 2021년도 벡터로 모두 만든 다음, plot함수를 이용해서 선그래프로 나타낼 것이다.
```{r}
#미국_수출건수 변화비율
수출건수_변화비율_2018<- round((data_2018$수출건수- data_2017$수출건수)/(data_2017$수출건수)*100)
수출건수_변화비율_2019<- round((data_2019$수출건수- data_2018$수출건수)/(data_2018$수출건수)*100)
수출건수_변화비율_2020<- round((data_2020$수출건수- data_2019$수출건수)/(data_2019$수출건수)*100)
수출건수_변화비율_2021<- round((c(data_2021$수출건수, c(NA, NA, NA, NA, NA))-data_2020$수출건수)/(data_2020$수출건수)*100)

plot(수출건수_변화비율_2021, type='o', col="black",  xlim=c(1, 12), ylim=c(-40, 150), main="Ratio of export number to year-on-year (USA)", xlab = 'month', ylab='portion' )
lines(수출건수_변화비율_2018, type='o', col="red")
lines(수출건수_변화비율_2019, type='o', col="blue")
lines(수출건수_변화비율_2020, type='o', col="green")
axis(1, at =1:12)
axis(2, at = seq(-40, 150, 10))
legend("topright", legend=c(2018, 2019, 2020, 2021), fill = c("red", "blue","green","black"))
```

미국은 2020년 2월주터 전년도의 수출건수_증가비율을 넘어섰으며, 2021년도 또한 2018, 2019년도의 증가비율보다 훨씬 더 컸다. 

코로나 팬데믹으로 우리나라의 수출건수가 이전보다 큰 비율로 증가했다고 할 수 있다.

```{r}
#미국_수입건수 변화비율
수입건수_변화비율_2018<- round((data_2018$수입건수- data_2017$수입건수)/(data_2017$수입건수)*100)
수입건수_변화비율_2019<- round((data_2019$수입건수- data_2018$수입건수)/(data_2018$수입건수)*100)
수입건수_변화비율_2020<- round((data_2020$수입건수- data_2019$수입건수)/(data_2019$수입건수)*100)
수입건수_변화비율_2021<- round((c(data_2021$수입건수, c(NA, NA, NA, NA, NA))-data_2020$수입건수)/(data_2020$수입건수)*100)

plot(수입건수_변화비율_2021, type='o', col="black",  xlim=c(1, 12), ylim=c(-40, 150), main="Ratio of import number to year-on-year (USA)",xlab = 'month', ylab='portion' )
lines(수입건수_변화비율_2018, type='o', col="red")
lines(수입건수_변화비율_2019, type='o', col="blue")
lines(수입건수_변화비율_2020, type='o', col="green")
axis(1, at =1:12)
axis(2, at = seq(-40, 150, 10))
legend("topright", legend=c(2018, 2019, 2020, 2021), fill = c("red", "blue","green","black"))
```

2020년 4월부터 8월까지 미국으로부터 수입하는 건수의 전년도 대비 증가비율이 이전 연도들에 비해 작았지만, 

그 이후 증가추세를 회복하면서 2021년 4월에는 이전 3개의 해들의 전년도 대비 증가비율보다 훨씬 높은 비율을 기록했다. 

하지만 미국의 전년도 대비 수출건수의 2020년, 2021년 증가 비율보다는 그 변화가 크지 않은 것으로 볼 수 있다. 

이것으로 미루어 볼 때, 코로나 팬데믹으로 수출은 큰 폭으로 증가했지만, 수입 건수는 2021년 4월에서야 전년도 증가 비율 대비 조금 더 높은 

상승세를 보이게 되었다고 할 수 있다. 데이터를 통해 수출의 규제보다 수입의 규제가 심할 것이라고 예상할 수 있다.   

중국도 똑같은 방식으로 그래프를 그려서 증가비율을 살펴본다. 

```{r}
new1 <-seperate_trade_df %>% filter(국가명=="중국") %>% 
  filter(year %in% c(2017, 2018, 2019, 2020, 2021))
  data_2017<-new1 %>% 
  filter(year== 2017)
data_2018<-new1 %>% 
  filter(year== 2018)
data_2019<-new1 %>% 
  filter(year== 2019)
data_2020<-new1 %>% 
  filter(year== 2020)
data_2021<-new1 %>% 
  filter(year== 2021)
  
#중국_수출건수 변화비율
수출건수_변화비율_2018<- round((data_2018$수출건수- data_2017$수출건수)/(data_2017$수출건수)*100)
수출건수_변화비율_2019<- round((data_2019$수출건수- data_2018$수출건수)/(data_2018$수출건수)*100)
수출건수_변화비율_2020<- round((data_2020$수출건수- data_2019$수출건수)/(data_2019$수출건수)*100)
수출건수_변화비율_2021<- round((c(data_2021$수출건수, c(NA, NA, NA, NA, NA))-data_2020$수출건수)/(data_2020$수출건수)*100)

plot(수출건수_변화비율_2021, type='o', col="black",  xlim=c(1, 12), ylim=c(-40,150 ), main="Ratio of export number to year-on-year (China)",xlab = 'month', ylab='portion' )
lines(수출건수_변화비율_2018, type='o', col="red")
lines(수출건수_변화비율_2019, type='o', col="blue")
lines(수출건수_변화비율_2020, type='o', col="green")
axis(1, at =1:12)
axis(2, at = seq(-40, 150, 10))
legend("topright", legend=c(2018, 2019, 2020, 2021), fill = c("red", "blue","green","black"))

#중국_수입건수 변화비율
수입건수_변화비율_2018<- round((data_2018$수입건수- data_2017$수입건수)/(data_2017$수입건수)*100)
수입건수_변화비율_2019<- round((data_2019$수입건수- data_2018$수입건수)/(data_2018$수입건수)*100)
수입건수_변화비율_2020<- round((data_2020$수입건수- data_2019$수입건수)/(data_2019$수입건수)*100)
수입건수_변화비율_2021<- round((c(data_2021$수입건수, c(NA, NA, NA, NA, NA))-data_2020$수입건수)/(data_2020$수입건수)*100)

plot(수입건수_변화비율_2021, type='o', col="black",  xlim=c(1, 12), ylim=c(-40, 150), main= "Ratio of import number to year-on-year (China)",xlab = 'month', ylab='portion' )
lines(수입건수_변화비율_2018, type='o', col="red")
lines(수입건수_변화비율_2019, type='o', col="blue")
lines(수입건수_변화비율_2020, type='o', col="green")
axis(1, at =1:12)
axis(2, at = seq(-40, 150, 10))
legend("topright", legend=c(2018, 2019, 2020, 2021), fill = c("red", "blue","green","black"))
```
중국의 수입건수 변화비율 그래프를 살펴보면 2020년도에 해당하는 초록 선과 2021년에 해당하는 검은 선이 다른 해의 선들보다 아래에 있는 것을 확인 할 수 있다.

전년도 대비 수출 건수가 2020년 3월부터 대부분의 달이 이전 해의 같은 달에 비해 낮은 증가 비율을 기록하면서, 또는 감소하는 현상을 

보이면서,코로나 팬데믹이 총 수출건수에 영향을 미쳤을 것으로 예상할 수 있다. 

중국의 수입건수 변화비율 그래프를 살펴보면, 2020년의 6월달부터 전년도 대비 수입건수 증가비율이 커졌음을 알 수 있다. 

2021년에도 전년도 대비 수입건수 대비 증가비율이 다른 년도 때 보다 확연히 큰 것을 볼 수 있다. 

### 4. Adding continent information

이 문제를 해결하기 위해서 여러 데이터를 합칠 때 고려해야 할 것은 다음과 같다.

ISO_code와 continent 데이터를 합쳐서 iso_code와 한국어와 영어로 된 국가 이름 그리고 대륙 이름 데이터를 얻는다.

그리고 이렇게 얻어진 데이터를 한국어 국가 이름을 기준으로 trade_df 데이터와 묶어준다.

하지만 여기서 고려해야 할 것은, 영어로 표기된 국가의 이름이 다를 수도, 한국어로 표기된 국가의 이름이 다를수도 있다는 것이다.

즉, 같은 나라이지만, 다른 표기법으로 인해 같은 나라지만 합쳐지지 않는 데이터가 있을 수 있다.

이를 고려하면서 작업을 수행하도록 한다.

```{r}
ISO_code <- ISO_code %>% 
  select(ISO3, Korean, English) %>% 
  rename(iso_code = ISO3, location = English) %>% 
  mutate(Korean = gsub(' ', '', Korean))

continent$location <- toupper(continent$location)

head(ISO_code, 5)
head(continent, 5)
```

continent와 ISO_code 데이터를 통해서 trade_df에 대륙 정보를 추가하도록 한다. 한편, trade_df에 국가 정보들이 한국어로 되어 있다.

따라서 국가코드, 영어와 한국어로 나라 이름을 표기한 ISO_code 데이터를 continent와 합쳐서 대륙 정보를 추가한 후, trade_df에 합치도록 한다.

이를 위해서 가장 먼저, ISC_code 데이터에서 필요한 코드정보, 한국어와 영어로 국가 이름을 표현한 데이터만 추린다. 여기서 한국어는 공백을 제거해주도록 한다.

그리고 영어로 표기된 국가 정보들이 동일하게 비교되도록 모두 다 대문자로 바꿔주도록 한다.

```{r}
length(unique(trade_df$국가명))
c(length(unique(ISO_code$iso_code)), length(unique(ISO_code$Korean)))
c(length(unique(continent$iso_code)), length(unique(continent$location)), length(unique(continent$continent)))
```

그 후, 합치게 될 데이터들의 고유한 값들의 개수를 확인해준다.

최종적으로 합치게 될 trade_df의 국가 정보가 가장 많았고, 그리고 ISO_code, continent 데이터 순서였다.

```{r}
length(intersect(ISO_code$iso_code, continent$iso_code))
setdiff(continent$iso_code, ISO_code$iso_code)
setdiff(ISO_code$iso_code, continent$iso_code)
```

join을 하기 전, 각 데이터들의 교집합과 차집합들의 값을 확인해보도록 한다.

가장 먼저, ISO_code와 continent 데이터에서 iso_code 값을 기준으로 교집합의 개수를 확인해보면, 204개가 나온다.

대륙의 정보를 담고 있는 continent 데이터가 206개였으므로, 2개를 제외하고는 모두 교집합이 있다는 것을 알 수 있다.

차집합으로 남은 2개를 확인하면, OWID_KOS와 OWID_CYN이 나오는 것을 알 수 있다. 이는 대륙 정보는 있지만, 한국 이름을 알기 어려운 국가이다.

한편, 반대로 차집합을 계산하면, 이 국가들은 한글 나라 이름은 알지만, 대륙 정보는 알 수 없는 국가들이다.

```{r}
continent_df <- left_join(ISO_code, continent, by = 'iso_code')
dim(continent_df[!is.na(continent_df$continent), ])
```

그렇다면, join을 한 후, 위의 내용이 맞는지 확인해보도록 한다.

iso_code를 기준으로 join을 하게 되면, 위에서 이야기한 교집합의 개수가 나와야 하고, dim 함수를 통해 204가 나오는 것을 알 수 있다.

```{r}
continent_df %>% 
  filter(location.x != location.y) %>% 
  select(iso_code, Korean, location.x, continent) %>% 
  head(10)
```

한편, 이 국가들은 ISO_code와 continent의 나라 이름의 표기가 다른 국가들이다.

비록 나라 이름의 표기는 달랐으나, iso_code가 동일해서 같이 동일하게 묶어줄 수 있었다.

```{r}
trade_df$국가명 <- gsub(' ', '', trade_df$국가명)
trade_df <- continent_df %>% 
              filter(!is.na(continent)) %>% 
              select(Korean, continent) %>% 
              rename(국가명=Korean) %>% 
              right_join(trade_df, by = '국가명')

head(trade_df, 10)
```

최종적으로는 앞서 ISO_code와 continent로 만든 한국어 국가 정보와 대륙 정보를 담은 데이터로 trade_df를 join 한다.

```{r}
unique(trade_df[is.na(trade_df$continent), ]$국가명)
```

하지만 대륙 변수의 NA가 있는 국가들을 찾아보니 101개의 나라가 발견되었다.

또한 확인해보니, 중국과 대만, 호주, 태국 등과 같이 사람들에게 잘 알려진 국가들도 잘 merge가 된 것 같지 않았다.

따라서 각각의 데이터를 직접 확인해보니, 다음과 같이 한글 국가 이름 표기가 다른 것을 확인할 수 있었다.

#### 한글 국가명 표기가 다른 국가들
```{r}
# 건지섬 - 건지, 과들루프 - 과델로프, 그린란드 - 그린랜드, 나우루 - 나우르, 네덜란드 - 네덜란드열도, 도미니카공화국 - 도미니카, 
# 러시아 - 러시아연방, 르완다 - 루안다, 룩셈부르크 - 룩셈부르그, 마다가스카르 - 마다카스카르, 마르티니크 - 마티니크, 몬트세랫 - 몬트세라트, 
# 미국령버진아일랜드 - 미령버진군도, 베네수엘라 - 베네주엘라, 벨라루스 - 베라루스, 벨리즈 - 벨리제, 보스니아헤르체고비나 - 보스니아-헤르체고비나, 
# 북마리아나제도 - 북마리아나군도, 상투메프린시페 - 상토메프린스페, 세이셸 - 세이쉘, 솔로몬제도 - 솔로몬군도, 스와질란드 - 스와질랜드, 
# 아랍에미리트 - 아랍에미리트연합, 아프가니스탄 - 아프카니스탄, 앙골라 - 앙귈라, 에리트레아 - 에리트리아, 에콰도르 - 에쿠아도르, 
# 영국령인도양지역 - 영령인도양, 영국령버진아일랜드 - 영령버진군도, 예멘 - 예맨, 왈리스퓌튀나 - 왈라스&퓨투나군도, 
# 우즈베키스탄 - 우즈베크, 에티오피아 - 이디오피아, 자메이카 - 자마이카, 저지섬 - 저어지, 중화인민공화국 - 중국, 대만 - 중화민국, 
# 지브롤터 - 지브랄타, 차드 - 챠드, 체코 - 체코공화국, 코모로 - 코모로스, 코트디부아르 - 코드디봐르, 콩고공화국 - 콩고, 
# 크리스마스섬 - 크리스마스아일랜드, 키프로스 - 사이프러스, 타이 - 태국, 조선민주주의인민공화국 - 북한, 투르크메니스탄 - 투르크멘, 
# 팔레스타인 - 팔레스타인해방기구, 포르투갈 - 포루투갈, 포클랜드제도 - 포클랜드군도, 허드맥도널드제도 - 허드앤맥도날드군도, 오스트레일리아 - 호주
```

```{r}
ISO_code <- 
  ISO_code %>% 
    mutate_all(~case_when(. == '건지섬' ~ '건지',  . == '과들루프' ~ '과델로프',  
                          . == '그린란드' ~ '그린랜드',  . == '나우루' ~ '나우르',  
                          . == '도미니카연방' ~ '도미니카',  
                          . == '러시아' ~ '러시아연방',  . == '르완다' ~ '루안다',  
                          . == '룩셈부르크' ~ '룩셈부르그',  . == '마다가스카르' ~ '마다카스카르',  
                          . == '마르티니크' ~ '마티니크',  . == '몬트세랫' ~ '몬트세라트',  
                          . == '미국령버진아일랜드' ~ '미령버진군도',  . == '베네수엘라' ~ '베네주엘라',  
                          . == '벨라루스' ~ '베라루스',  . == '벨리즈' ~ '벨리제',  
                          . == '보스니아헤르체고비나' ~ '보스니아-헤르체고비나',  . == '북마리아나제도' ~ '북마리아나군도',  
                          . == '상투메프린시페' ~ '상토메프린스페',  . == '세이셸' ~ '세이쉘',  
                          . == '솔로몬제도' ~ '솔로몬군도',  . == '스와질란드' ~ '스와질랜드',  
                          . == '아랍에미리트' ~ '아랍에미리트연합',  . == '아프가니스탄' ~ '아프카니스탄',  
                          . == '에리트레아' ~ '에리트리아',  
                          . == '에콰도르' ~ '에쿠아도르',  . == '영국령인도양지역' ~ '영령인도양',  
                          . == '영국령버진아일랜드' ~ '영령버진군도',  . == '예멘' ~ '예맨',  
                          . == '왈리스퓌튀나' ~ '왈라스&퓨투나군도',  . == '우즈베키스탄' ~ '우즈베크',  
                          . == '에티오피아' ~ '이디오피아',  . == '자메이카' ~ '자마이카',  
                          . == '저지섬' ~ '저어지',  . == '중화인민공화국' ~ '중국',  
                          . == '중화민국' ~ '대만',  . == '지브롤터' ~ '지브랄타',
                          . == '차드' ~ '챠드',  . == '체코' ~ '체코공화국',  
                          . == '코모로' ~ '코모로스',  . == '코트디부아르' ~ '코드디봐르',  
                          . == '크리스마스섬' ~ '크리스마스아일랜드',  
                          . == '키프로스' ~ '사이프러스',  . == '타이' ~ '태국',  
                          . == '조선민주주의인민공화국' ~ '북한',  . == '투르크메니스탄' ~ '투르크멘',
                          . == '팔레스타인' ~ '팔레스타인해방기구',  . == '포르투갈' ~ '포루투갈',
                          . == '포클랜드제도' ~ '포클랜드군도',  . == '허드맥도널드제도' ~ '허드앤맥도날드군도',
                          . == '오스트레일리아' ~ '호주', TRUE ~ .))

continent_df <- full_join(ISO_code, continent, by = 'iso_code')
trade_df <- trade_df[, c('국가명', '기간', '수출건수', '수출금액', '수입건수', '수입금액', '무역수지')]
trade_df <- continent_df %>% 
  filter(!is.na(continent)) %>% 
  select(Korean, continent) %>% 
  rename(국가명=Korean) %>% 
  right_join(trade_df, by = '국가명')

unique(trade_df[is.na(trade_df$continent), ]$국가명)

trade_df %>% 
  filter(기간 == '2000-01-01') %>% 
  select(-기간) %>% 
  head(10)
```

위에서 이야기 했던 것처럼 한글 국가명 표기가 다른 것들을 모두 통일한 후, 다시 수출입 데이터와 continent 데이터를 merge 해준다.

그리고 대륙 정보가 없는 국가를 다시 뽑아보면, 아까보다 소폭 준 64개 국가만 대륙 정보가 표기되지 못한 것을 알 수 있다.

수출입 데이터에 대륙 정보가 함께 저장된 데이터를 확인할 수 있다.

### 5. 대한민국과 무역을 가장 많이 하는 국가와 대륙
##### 5.1 2000년부터 2021년까지 전체 기간에 대한 무역 건수 추이
```{r}
trade_df %>%
  group_by(국가명, year(기간)) %>%
  mutate(yearly_total = sum(수출건수 + 수입건수), 
         yearly_import = sum(수입건수), 
         yearly_export = sum(수출건수)) %>% 
  select(continent, yearly_total, yearly_import, yearly_export) %>% 
  unique() %>% 
  group_by(continent) %>% 
  summarise(total_export_import = sum(yearly_total), 
         total_import = sum(yearly_import), 
         total_export = sum(yearly_export)) %>% 
  melt(id = 'continent') %>% 
  ggplot(aes(x = reorder(continent, -value), y = value, fill = variable)) +
  geom_bar(stat = "identity", color = 'black') +
  labs(title = "2000~2021년 대륙별 수출 및 수입건수 합계") + xlab("continent") +
  theme(plot.title = element_text(hjust=0.5), 
        axis.text.x=element_text(color = "black", size = 10, angle=30, vjust=.8, hjust=0.8))
```

대한민국과 가장 많이 무역을 하는 대륙은 어디인지 확인해보도록 한다.

먼저는 2000년부터 2021년까지 약 21년 동안 전체 수입과 수출 건수의 합 그리고 개별적인 수입과 수출 건수 각각의 합을 비교해보도록 한다.

이를 그래프로 표현하면 다음과 같음을 알 수 있다. 

전체 무역건수(수출과 수입 건수의 합)가 가장 많은 대륙은 아시아 - 북아메리카 - 유럽 - 오세아니아 - 남아메리카 - 아프리카 순이다.

또한 수입건수가 많은 대륙은 북아메리카 - 아시아 - 유럽 - 오세아니아 - 남아메리카 - 아프리카 순이다.

수출건수의 경우에는 전체 무역건수의 대륙 순서와 동일하다.

북아메리카의 경우, 아시아에 비해서 수입건수는 많았지만, 수출건수가 낮아서 전체 무역 순위에서 밀린 것으로 확인된다.

```{r}
trade_df %>%
  group_by(국가명, year(기간)) %>%
  mutate(yearly_total = sum(수출건수 + 수입건수), 
         yearly_import = sum(수입건수), 
         yearly_export = sum(수출건수)) %>% 
  select(continent, yearly_total, yearly_import, yearly_export) %>% 
  unique() %>% 
  group_by(continent) %>% 
  summarise(total_export_import = sum(yearly_total), 
            total_import = sum(yearly_import), 
            total_export = sum(yearly_export)) %>% 
  arrange(desc(total_export_import))
```

2000년부터 2021년까지 전체 기간에 대한 대륙 별 통계값을 보면 다음과 같음을 확인할 수 있다.

```{r}
trade_df %>%
  group_by(국가명, year(기간)) %>%
  mutate(yearly_total = sum(수출건수 + 수입건수), 
         yearly_import = sum(수입건수), 
         yearly_export = sum(수출건수)) %>% 
  select(continent, yearly_total, yearly_import, yearly_export) %>% 
  unique() %>% 
  group_by(국가명) %>% 
  summarise(total_export_import = sum(yearly_total), 
            total_import = sum(yearly_import), 
            total_export = sum(yearly_export)) %>% 
  arrange(desc(total_export_import)) %>% 
  head(10) %>% 
  melt(id = '국가명') %>% 
  ggplot(aes(x = reorder(국가명, -value), y = value, fill = variable)) +
  geom_bar(stat = "identity", color = 'black') +
  labs(title = "2000~2021년 대한민국과의 무역 건수 상위 10개국") + xlab("국가명") +
  theme(plot.title = element_text(hjust=0.5), 
        axis.text.x=element_text(color = "black", size = 10, angle=30, vjust=.8, hjust=0.8))
```

대륙이 아닌 개별 국가들 중에서 우리나라와 무역 건수가 높은 상위 10개 국가들도 확인해보도록 한다.

조금 주의 깊게 확인해볼 수 있는 것은 다음과 같다.

- 미국은 우리나라의 수출보다 수입량이 압도적으로 많아 전체 무역 건수의 1순위이다.
- 우리나라는 미국보다 중국에 대하여 수출량이 많다.
- 독일은 우리나라가 수출을 많이 하지는 않지만, 수입을 많이해서 전체 무역 건수 4순위이다.
- 중국, 일본, 홍콩, 베트남, 싱가포르 등 아시아 국가들의 무역 건수가 많음을 알 수 있다.

##### 5.2 2018년부터 2021년까지 전체 기간에 대한 무역 건수 추이
```{r}
trade_df %>%
  group_by(국가명, year(기간)) %>%
  mutate(yearly_total = sum(수출건수 + 수입건수), 
         yearly_import = sum(수입건수), 
         yearly_export = sum(수출건수)) %>% 
  filter(year(기간) >= 2018) %>% 
  select(continent, yearly_total, yearly_import, yearly_export) %>% 
  unique() %>% 
  group_by(continent) %>% 
  summarise(total_export_import = sum(yearly_total), 
            total_import = sum(yearly_import), 
            total_export = sum(yearly_export)) %>% 
  melt(id = 'continent') %>% 
  ggplot(aes(x = reorder(continent, -value), y = value, fill = variable)) +
  geom_bar(stat = "identity", color = 'black') +
  labs(title = "2018~2021년 대륙별 수출 및 수입건수 합계") + xlab("continent") +
  theme(plot.title = element_text(hjust=0.5), 
        axis.text.x=element_text(color = "black", size = 10, angle=30, vjust=.8, hjust=0.8))
```

앞선 그래프에서는 2000년부터 2021년의 약 21년동안의 긴 기간에 대한 무역 건수를 확인해보았다.

그렇다면, 비교적 최근 기간인 2018년부터 2021년의 대륙별 무역 건수 추이는 어떻게 변화할지 확인해보도록 한다.

위 과정과 동일하게 그래프를 표현해보면 다음과 같음을 알 수 있다.

확연하게 보이는 것은, 전체 기간에 대해 무역 건수가 가장 많은 대륙은 아시아였으나, 최근 기간에는 북아메리카로 바뀌었다.

그리고 그 이유는 최근 기간동안 북아메리카 대륙의 국가들에 대해 수입량이 압도적으로 많았음을 확인할 수 있다.

따라서 최근 기간의 무역 건수가 가장 많은 대륙의 순서는 북아메리카 - 아시아 - 유럽 - 오세아니아 - 아프리카 - 남아메리카 순이다.

수입 건수가 가장 많은 대륙의 순서는 북아메리카 - 아시아 - 유럽 - 오세아니아 - 남아메리카 - 아프리카 순이다.

수출 건수가 가장 많은 대륙의 순서는 아시아 - 북아메리카 - 유럽 - 아프리카 - 남아메리카 - 오세아니아 순이다.

아프리카 대륙의 수출 건수가 최근에 많이 증가한 것도 확인해볼 수 있다.

```{r}
trade_df %>%
  group_by(국가명, year(기간)) %>%
  mutate(yearly_total = sum(수출건수 + 수입건수), 
         yearly_import = sum(수입건수), 
         yearly_export = sum(수출건수)) %>% 
  filter(year(기간) >= 2018) %>% 
  select(continent, yearly_total, yearly_import, yearly_export) %>% 
  unique() %>% 
  group_by(continent) %>% 
  summarise(total_export_import = sum(yearly_total), 
            total_import = sum(yearly_import), 
            total_export = sum(yearly_export)) %>% 
  arrange(desc(total_export_import))
```

2018년부터 2021년까지 전체 기간에 대한 대륙 별 통계값을 보면 다음과 같음을 확인할 수 있다.

```{r}
trade_df %>%
  group_by(국가명, year(기간)) %>%
  mutate(yearly_total = sum(수출건수 + 수입건수), 
         yearly_import = sum(수입건수), 
         yearly_export = sum(수출건수)) %>% 
  filter(year(기간) >= 2018) %>% 
  select(continent, yearly_total, yearly_import, yearly_export) %>% 
  unique() %>% 
  group_by(국가명) %>% 
  summarise(total_export_import = sum(yearly_total), 
            total_import = sum(yearly_import), 
            total_export = sum(yearly_export)) %>% 
  arrange(desc(total_export_import)) %>% 
  head(10) %>% 
  melt(id = '국가명') %>% 
  ggplot(aes(x = reorder(국가명, -value), y = value, fill = variable)) +
  geom_bar(stat = "identity", color = 'black') +
  labs(title = "2018~2021년 대한민국과의 무역 건수 상위 10개국") + xlab("국가명") +
  theme(plot.title = element_text(hjust=0.5), 
        axis.text.x=element_text(color = "black", size = 10, angle=30, vjust=.8, hjust=0.8))
```

또한 최근 기간에 대해서 무역 건수가 많았던 상위 10개 국가들을 출력해보면 다음과 같다.

특별히 확인해볼 수 있는 것은 독일, 이탈리아, 영국 등 유럽 국가들이 조금 늘어난 것을 확인할 수 있다.

### 6. 2000년대 들어와서 우리나라와 무역 규모가 가장 크게 상승한 국가
```{r}
std_df <- trade_df %>% 
            group_by(국가명, year(기간)) %>% 
            mutate(yearly_total = sum(수출건수 + 수입건수), 
                   yearly_import = sum(수입건수), 
                   yearly_export = sum(수출건수)) %>% 
            select(continent, yearly_total, yearly_import, yearly_export) %>% 
            unique() %>% 
            group_by(국가명) %>% 
            summarise(std = sd(yearly_total)) %>% 
            arrange(desc(std))

head(std_df, 10)
tail(std_df, 10)
```

2000년대 들어와서 우리나라와 무역 규모가 가장 크게 변화된 국가들을 확인해보도록 한다.

이를 위해서 연도별 수출 및 수입 건수의 합계 데이터에 대하여 각 국가별로 표준편차를 계산하도록 한다.

이를 통해 얼마나 그 값의 변동성이 컸는지 혹은 작았는지 그 분포를 확인해보도록 한다.

위 결과에서 확인할 수 있듯, 그 변동성이 가장 컸던 상위 10개 국가는 미국, 중국, 일본, 독일, 베트남 등이다.

또한 그 변동성이 가장 작았던 국가들은 불령남부지역, 피트카이른, 보빗군도, 세인트마틴 등이다.

그렇다면, 이 국가들의 실제 무역 추이에 대한 그래프를 통해서 이 값들을 직관적으로 확인해보도록 한다.

```{r}
top_5 <- head(std_df, 5)$국가명
top_5
top_5 <- trade_df %>% 
          group_by(국가명, year(기간)) %>% 
          mutate(yearly_total = sum(수출건수 + 수입건수), 
                 yearly_import = sum(수입건수), 
                 yearly_export = sum(수출건수)) %>% 
          select(continent, yearly_total, yearly_import, yearly_export) %>% 
          unique() %>% 
          filter(국가명 %in% top_5) %>% 
          select(국가명, 'year(기간)', yearly_total)

ggplot(top_5, aes(x = `year(기간)`)) +
  geom_line(aes(y = yearly_total, col = 국가명))
```

무역 규모의 변동성이 컸던 상위 5개 나라(미국, 중국, 일본, 독일, 베트남)에 대한 그래프를 확인해보도록 한다.

2015년 이후에 무역 규모가 급격하게 증가한 국가는 미국이라는 것을 바로 확인할 수 있다.

또한 중국 역시 최근에 그 규모가 감소하긴 했으나, 그럼에도 불구하고 2000년에 비해서는 많이 증가한 것을 확인할 수 있다.

한편, 독일과 베트남, 일본 역시 매우 상승했으나 해당 그래프에서는 미국과 중국의 추이가 너무 급해서 잘 보이지 않는다.

따라서 해당 국가들의 추이를 따로 그래프를 그려서 다시 확인해보았다.

```{r}
top_5 %>% 
  filter(국가명 %in% c('베트남', '일본', '독일')) %>% 
  ggplot(aes(x = `year(기간)`)) +
  geom_line(aes(y = yearly_total, col = 국가명))
```

y축의 범위가 백만 단위이므로, 베트남의 경우에는 2000년에 비해 약 1백만배 상승, 독일은 2.5백만배, 일본은 4백만배 정도 상승했다.

이를 통해서 독일과 베트남, 일본 국가들 역시 무역 규모가 상당히 커진 국가들이라는 것을 알 수 있다.

```{r}
under_10 <- tail(std_df, 10)$국가명  
under_10
under_10 <- trade_df %>% 
              group_by(국가명, year(기간)) %>% 
              mutate(yearly_total = sum(수출건수 + 수입건수), 
                     yearly_import = sum(수입건수), 
                     yearly_export = sum(수출건수)) %>% 
              select(continent, yearly_total, yearly_import, yearly_export) %>% 
              unique() %>% 
              filter(국가명 %in% under_10) %>% 
              select(국가명, 'year(기간)', yearly_total)

ggplot(under_10, aes(x = `year(기간)`)) +
  geom_line(aes(y = yearly_total, col = 국가명))
```

무역 규모의 변동성이 작았던 상위 10개 나라에 대한 그래프를 확인해보도록 한다.

위에서 확인했던 무역 규모가 컸던 국가들에 대한 그래프와 다르게, 전반적으로 y축의 범위가 0부터 8 정도로 매우 적은 것을 알 수 있다.

그래프 상에서는 변동성이 커보이지만, y축의 범위를 상위 그래프의 범위와 동일하게 표시한다면 거의 움직임이 없을 것이다.

```{r}
ggplot(under_10, aes(x = `year(기간)`)) +
  geom_line(aes(y = yearly_total, col = 국가명)) +
  ylim(0, 100)
```

실제로 y축의 범위를 0부터 100까지만 하더라도, 움직임이 거의 없는 것을 확인할 수 있다.

```{r}
top_country <- trade_df %>% 
                 group_by(국가명) %>% 
                 summarise(Total_trade = sum(수출건수 + 수입건수)) %>% 
                 arrange(desc(Total_trade))

top_country
summary(top_country)
```

하지만 현재 나온 결과는 우리가 익히 들어봤거나, 쉽게 아는 국가들이 아니기 때문에 어느 정도 무역량이 있는 국가들만 추려서 다시 결과를 확인해보도록 한다.

이를 추리기 위해 수출건수와 수입건수의 합이 중앙값보다 큰 국가들만 추려서 해당 결과로 값을 확인해보도록 한다.

현재 결과를 보면, 중앙값이 20932로 나오는 것을 확인할 수 있다.

```{r}
top_country <- top_country %>% 
                filter(Total_trade >= 20932) %>% 
                tail(10) %>% 
                select(국가명)

top_country
```

그래서 하위 10개 국가를 뽐으면, 기니, 벨라루스, 볼리비아, 세르비아 등의 나라가 나오는 것을 확인할 수 있다.

```{r}
new_under_10 <- trade_df %>% 
                  group_by(국가명, year(기간)) %>% 
                  mutate(yearly_total = sum(수출건수 + 수입건수), 
                         yearly_import = sum(수입건수), 
                         yearly_export = sum(수출건수)) %>% 
                  select(continent, yearly_total, yearly_import, yearly_export) %>% 
                  unique() %>% 
                  filter(국가명 %in% as.vector(top_country$국가명)) %>% 
                  select(국가명, 'year(기간)', yearly_total)

ggplot(new_under_10, aes(x = `year(기간)`)) +
  geom_line(aes(y = yearly_total, col = 국가명))
```

따라서 이 국가들로 다시 그래프를 그려보면, 처음에 그렸던 그래프보다 그 범위가 조금 넓어진 것을 볼 수 있다.

하지만 그럼에도 불구하고, 가장 처음에 그렸던 상위 국가들에 비해서는 그 범위가 여전히 많이 작다는 것도 알 수 있다.

### 7. 집권한 정부마다의 무역량 변화 추이

![](역대정부.png)

인터넷 자료에 따르면, 2000년 이후 대한민국의 역대 정부는 위와 같음을 알 수 있다.

무역량 데이터는 2000년 이후 데이터이므로, 김대중 정부부터 현재 문재인 정부까지 역대 대통령과 정권 성향을 새로운 열로 만들어보도록 한다.

```{r}
trade_df <- trade_df %>% 
              mutate(역대정부 = case_when(
                between(기간, as.Date('1998-02-25'), as.Date('2003-02-24')) ~ '김대중_정부',
                between(기간, as.Date('2003-02-25'), as.Date('2008-02-25')) ~ '노무현_정부',
                between(기간, as.Date('2008-02-26'), as.Date('2013-02-25')) ~ '이명박_정부',
                between(기간, as.Date('2013-02-26'), as.Date('2017-05-10')) ~ '박근혜_정부',
                between(기간, as.Date('2017-05-11'), as.Date('2022-05-09')) ~ '문재인_정부'), 
                    정권성향 = case_when(
                between(기간, as.Date('1998-02-25'), as.Date('2003-02-24')) ~ '진보',
                between(기간, as.Date('2003-02-25'), as.Date('2008-02-25')) ~ '진보',
                between(기간, as.Date('2008-02-26'), as.Date('2013-02-25')) ~ '보수',
                between(기간, as.Date('2013-02-26'), as.Date('2017-05-10')) ~ '보수',
                between(기간, as.Date('2017-05-11'), as.Date('2022-05-09')) ~ '진보'),      
                )
  
start <- trade_df %>% 
           filter(!duplicated(역대정부)) %>% 
           select(기간, 역대정부, 정권성향) %>%
           rename(start = 기간)

end <- trade_df %>% 
         arrange(desc(기간)) %>% 
         filter(!duplicated(역대정부)) %>% 
         select(기간, 역대정부, 정권성향) %>% 
         rename(end = 기간)

start_end <- right_join(start, end, by = c('역대정부', '정권성향'))
start_end <- start_end[, c('start', 'end', '역대정부', '정권성향')]
start_end
```

위에서 찾은 역대 정부 결과를 바탕으로 역대정부와 정권성향을 담은 새로운 변수를 만든다.

그리고 각 정부 및 시기 별로 잘 들어갔는지 결과를 확인해보도록 한다.

```{r}
palette(usecol(pal_unikn, n = 5))  
trade_df %>% 
  group_by(역대정부, 기간) %>% 
  summarise(전체수출건수 = sum(수출건수), 
            전체수입건수 = sum(수입건수)) %>% 
  melt(id=c('역대정부', '기간')) %>% 
  ggplot(aes(x = 기간, y = value, fill = variable)) +
  geom_rect(aes(xmin = as.Date('2000-01-01'), xmax = as.Date('2003-02-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau5, alpha = 0.01) +
  geom_rect(aes(xmin = as.Date('2003-03-01'), xmax = as.Date('2008-02-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau4, alpha = 0.01) +
  geom_rect(aes(xmin = as.Date('2008-03-01'), xmax = as.Date('2013-02-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau3, alpha = 0.01) +
  geom_rect(aes(xmin = as.Date('2013-03-01'), xmax = as.Date('2017-05-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau2, alpha = 0.01) +
  geom_rect(aes(xmin = as.Date('2017-06-01'), xmax = as.Date('2021-07-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau1, alpha = 0.01) +
  geom_line(aes(color = variable), size = 1) +
  geom_text(aes(x = as.Date('2000-01-01'), y = 3000000, label = 'DJ'), 
            size = 7, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  geom_text(aes(x = as.Date('2003-03-01'), y = 3000000, label = 'MH'), 
            size = 7, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  geom_text(aes(x = as.Date('2008-03-01'), y = 3000000, label = 'MB'), 
            size = 7, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  geom_text(aes(x = as.Date('2013-03-01'), y = 3000000, label = 'GH'), 
            size = 7, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  geom_text(aes(x = as.Date('2017-06-01'), y = 3000000, label = 'JI'), 
            size = 7, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  ggtitle('대한민국 각 정부별 전체 수출 및 수입 건수의 합계') + 
  theme(plot.title = element_text(hjust=0.5))
```

가장 먼저는 역대정부와 기간 별로 수출건수와 수입건수의 합으로 그래프를 그려보도록 한다.

또한 이 과정에서는 geom_rect 함수를 통해서 김대중 정부부터 문재인 정부까지 DJ, MH, MB, GH, JI로 표시하여 나눠보았다.

이 그래프는 전반적으로 우상향 하는 추이를 보이고 있어서 조금 더 구체적으로 주요 국가별로의 통계를 확인해보도록 한다.

```{r}
trade_df %>% 
  filter(국가명 %in% c('미국', '중국', '일본', '러시아연방', 
                       '독일', '영국')) %>% 
  select(국가명, 기간, 무역수지) %>% 
  ggplot(aes(x = 기간, y = 무역수지, fill = 국가명)) +
  geom_rect(aes(xmin = as.Date('2000-01-01'), xmax = as.Date('2003-02-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau5, alpha = 0.01) +
  geom_rect(aes(xmin = as.Date('2003-03-01'), xmax = as.Date('2008-02-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau4, alpha = 0.01) +
  geom_rect(aes(xmin = as.Date('2008-03-01'), xmax = as.Date('2013-02-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau3, alpha = 0.01) +
  geom_rect(aes(xmin = as.Date('2013-03-01'), xmax = as.Date('2017-05-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau2, alpha = 0.01) +
  geom_rect(aes(xmin = as.Date('2017-06-01'), xmax = as.Date('2021-07-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau1, alpha = 0.01) +
  geom_line(aes(color = 국가명)) + 
  geom_text(aes(x = as.Date('2000-01-01'), y = 6500000, label = 'DJ'), 
            size = 10, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  geom_text(aes(x = as.Date('2003-03-01'), y = 6500000, label = 'MH'), 
            size = 10, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  geom_text(aes(x = as.Date('2008-03-01'), y = 6500000, label = 'MB'), 
            size = 10, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  geom_text(aes(x = as.Date('2013-03-01'), y = 6500000, label = 'GH'), 
            size = 10, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  geom_text(aes(x = as.Date('2017-06-01'), y = 6500000, label = 'JI'), 
            size = 10, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  ggtitle('대한민국 각 정부별 주요 국가에 대한 무역수지 추이') + 
  theme(plot.title = element_text(hjust=0.5))
```

이번에는 미국, 중국, 일본, 러시아, 독일, 영국 등 주요 국가에 대해 우리나라의 무역수지 추이를 알아보도록 한다.

이 그래프 역시 위와 동일하게, 각 정권을 geom_rect으로 표현하여 정권 별로 차이가 있는지 확인해보도록 한다.

가장 먼저 눈에 띄는 것은 우리나라와 일본의 무역수지는 모든 정권에서 확연히 음수로 유지되고 있는 것을 확인할 수 있다.

또한 이명박 정부에서 대중 무역수지가 급격하게 증가한 것도 확실히 확인할 수가 있다.

그렇다면, 마지막으로는 우리나라와 무역수지가 가장 컸거나, 작았던 국가들을 확인해보도록 한다.

```{r}
under_mean <- trade_df %>% 
                group_by(국가명) %>% 
                summarise(평균 = mean(무역수지)) %>% 
                arrange(평균) %>% 
                select(국가명) %>% 
                head(5)

top_mean <- trade_df %>% 
              group_by(국가명) %>% 
              summarise(평균 = mean(무역수지)) %>% 
              arrange(desc(평균)) %>% 
              select(국가명) %>% 
              head(5)

top_under <- rbind(top_mean, under_mean)
top_under
```

2000년부터 2020년까지 전체 무역수지의 평균이 가장 컸던 국가와 작았던 국가만을 먼저 찾는다.

```{r}
trade_df %>% 
  filter(국가명 %in% top_mean$국가명) %>% 
  select(국가명, 기간, 무역수지) %>% 
  ggplot(aes(x = 기간, y = 무역수지, fill = 국가명)) +
  geom_rect(aes(xmin = as.Date('2000-01-01'), xmax = as.Date('2003-02-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau5, alpha = 0.01) +
  geom_rect(aes(xmin = as.Date('2003-03-01'), xmax = as.Date('2008-02-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau4, alpha = 0.01) +
  geom_rect(aes(xmin = as.Date('2008-03-01'), xmax = as.Date('2013-02-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau3, alpha = 0.01) +
  geom_rect(aes(xmin = as.Date('2013-03-01'), xmax = as.Date('2017-05-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau2, alpha = 0.01) +
  geom_rect(aes(xmin = as.Date('2017-06-01'), xmax = as.Date('2021-07-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau1, alpha = 0.01) +
  geom_line(aes(color = 국가명)) + 
  geom_text(aes(x = as.Date('2000-01-01'), y = 6500000, label = 'DJ'), 
            size = 10, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  geom_text(aes(x = as.Date('2003-03-01'), y = 6500000, label = 'MH'), 
            size = 10, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  geom_text(aes(x = as.Date('2008-03-01'), y = 6500000, label = 'MB'), 
            size = 10, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  geom_text(aes(x = as.Date('2013-03-01'), y = 6500000, label = 'GH'), 
            size = 10, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  geom_text(aes(x = as.Date('2017-06-01'), y = 6500000, label = 'JI'), 
            size = 10, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  ggtitle('대한민국 각 정부별 주요 국가에 대한 무역수지 상위 국가 추이') + 
  theme(plot.title = element_text(hjust=0.5))
```

우리나라와 무역수지가 컸던 상위 5개 국가에 대한 무역수지 추이를 그래프로 표현해본다.

무역수지가 컸다는 것은 우리나라가 해당 국가에 수입보다, 수출을 많이 했다는 것으로 미국, 베트남, 싱가포르, 중국, 홍콩 국가이다.

미국을 제외하고는, 모두 아시아 국가이면서 우리나라와 근방에 있는 국가라는 것을 확인할 수 있다.

```{r}
trade_df %>% 
  filter(국가명 %in% under_mean$국가명) %>% 
  select(국가명, 기간, 무역수지) %>% 
  ggplot(aes(x = 기간, y = 무역수지, fill = 국가명)) +
  geom_rect(aes(xmin = as.Date('2000-01-01'), xmax = as.Date('2003-02-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau5, alpha = 0.01) +
  geom_rect(aes(xmin = as.Date('2003-03-01'), xmax = as.Date('2008-02-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau4, alpha = 0.01) +
  geom_rect(aes(xmin = as.Date('2008-03-01'), xmax = as.Date('2013-02-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau3, alpha = 0.01) +
  geom_rect(aes(xmin = as.Date('2013-03-01'), xmax = as.Date('2017-05-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau2, alpha = 0.01) +
  geom_rect(aes(xmin = as.Date('2017-06-01'), xmax = as.Date('2021-07-01'), 
                ymin = -Inf, ymax = Inf), fill = pal_unikn$seeblau1, alpha = 0.01) +
  geom_line(aes(color = 국가명)) + 
  geom_text(aes(x = as.Date('2000-01-01'), y = 2500000, label = 'DJ'), 
            size = 10, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  geom_text(aes(x = as.Date('2003-03-01'), y = 2500000, label = 'MH'), 
            size = 10, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  geom_text(aes(x = as.Date('2008-03-01'), y = 2500000, label = 'MB'), 
            size = 10, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  geom_text(aes(x = as.Date('2013-03-01'), y = 2500000, label = 'GH'), 
            size = 10, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  geom_text(aes(x = as.Date('2017-06-01'), y = 2500000, label = 'JI'), 
            size = 10, vjust = 0, hjust = 0, nudge_x = 50, check_overlap = TRUE) +
  ggtitle('대한민국 각 정부별 주요 국가에 대한 무역수지 하위 국가 추이') + 
  theme(plot.title = element_text(hjust=0.5))
```

우리나라와 무역수지가 작았던 상위 5개 국가는 사우디아라비아, 일본, 카타르, 쿠웨이트, 호주가 있다.

전반적으로 사우디아라비아, 카타르, 쿠웨이트는 산유국으로, 석유 수입이 많은 것으로 추정된다.

또한 호주는 석탄, 철광석, 구리 등 원자재 수입이 많아서 이러한 결과가 나온 것으로 추정된다.